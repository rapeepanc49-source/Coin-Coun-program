<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONI COUN PROGRAM // VTX-ULTRA</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@800;900&family=Kanit:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-magenta: #ff00ff;
            --neon-gold: #ffcc00;
            --dark-bg: #02040a;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--dark-bg);
            color: #ffffff;
            overflow-x: hidden;
            margin: 0;
            perspective: 1000px;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }
        .kanit { font-family: 'Kanit', sans-serif; }

        /* Enhanced Background with 3D Grid */
        #bg-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 50%, #0a1128 0%, #02040a 100%);
        }

        .grid-floor {
            position: fixed;
            bottom: -50%; left: -50%; width: 200%; height: 100%;
            background-image: linear-gradient(var(--neon-cyan) 1px, transparent 1px), 
                              linear-gradient(90deg, var(--neon-cyan) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: rotateX(60deg);
            opacity: 0.15;
            z-index: -1;
            animation: move-grid 20s linear infinite;
        }

        @keyframes move-grid {
            0% { background-position: 0 0; }
            100% { background-position: 0 500px; }
        }

        /* Ultra Bold Glowing Text */
        .glow-text {
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: 2px;
            color: #fff;
            text-shadow: 
                0 0 7px rgba(255, 255, 255, 0.3),
                0 0 10px var(--neon-cyan),
                0 0 21px var(--neon-cyan),
                0 0 42px var(--neon-cyan);
            filter: brightness(1.2);
        }

        .magenta-glow {
            text-shadow: 0 0 10px var(--neon-magenta), 0 0 20px var(--neon-magenta);
            color: var(--neon-magenta);
        }

        /* Cyber Glass Container */
        .cyber-panel {
            background: rgba(10, 20, 40, 0.6);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(0, 243, 255, 0.5);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2), inset 0 0 15px rgba(0, 243, 255, 0.1);
            position: relative;
            border-radius: 4px;
        }

        .cyber-panel::after {
            content: "";
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, var(--neon-cyan), transparent, var(--neon-magenta));
            z-index: -1;
            filter: blur(5px);
            opacity: 0.5;
        }

        /* Intense Buttons */
        .btn-core {
            position: relative;
            background: #000;
            border: 2px solid var(--neon-gold);
            color: var(--neon-gold);
            font-weight: 900;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-shadow: 0 0 5px var(--neon-gold);
        }

        .btn-core:hover {
            transform: scale(1.05) translateY(-5px);
            background: var(--neon-gold);
            color: #000;
            box-shadow: 0 0 40px var(--neon-gold);
        }

        /* Scanning Animation */
        .scan-line {
            position: absolute;
            width: 100%;
            height: 10px;
            background: linear-gradient(to bottom, transparent, var(--neon-cyan), transparent);
            box-shadow: 0 0 20px var(--neon-cyan);
            top: 0;
            left: 0;
            animation: scan 1.5s infinite linear;
            z-index: 30;
        }

        @keyframes scan {
            0% { top: -10%; }
            100% { top: 110%; }
        }

        /* Large Result Number */
        .total-display {
            font-size: 5.5rem;
            line-height: 1;
            background: linear-gradient(to bottom, #fff 40%, var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.8));
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-6">
    <canvas id="bg-canvas"></canvas>
    <div class="grid-floor"></div>

    <div class="w-full max-w-xl">
        <!-- HEADER SECTION -->
        <header class="text-center mt-12 mb-16 relative">
            <div class="inline-block px-4 py-1 mb-4 border border-cyan-500/50 bg-cyan-950/30 rounded-full">
                <span class="orbitron text-[10px] font-black tracking-[0.5em] text-cyan-400">MK-V ULTRA ENGINE</span>
            </div>
            
            <!-- เปลี่ยนชื่อแอปเป็น CONI COUN PROGRAM -->
            <h1 class="orbitron glow-text text-5xl md:text-6xl mb-2 italic">
                CONI COUN <br> <span class="magenta-glow text-4xl">PROGRAM</span>
            </h1>
            
            <div class="flex justify-center items-center gap-3">
                <div class="h-1 w-20 bg-gradient-to-r from-transparent via-cyan-400 to-transparent"></div>
                <p class="orbitron text-[11px] font-black tracking-widest text-cyan-200/60 uppercase">Quantum High Intensity</p>
                <div class="h-1 w-20 bg-gradient-to-r from-transparent via-cyan-400 to-transparent"></div>
            </div>
        </header>

        <!-- MAIN INTERFACE -->
        <div class="cyber-panel p-1">
            <div class="bg-black/40 p-8">
                <div class="grid grid-cols-2 gap-6 mb-10">
                    <button onclick="document.getElementById('inp-file').click()" class="btn-core h-32 flex flex-col items-center justify-center gap-2 group">
                        <i class="fa-solid fa-cloud-arrow-up text-3xl mb-2"></i>
                        <span class="orbitron tracking-tighter text-xs">LOAD_DATA</span>
                        <div class="absolute bottom-1 w-4/5 h-1 bg-current opacity-20"></div>
                    </button>
                    
                    <button onclick="document.getElementById('inp-camera').click()" class="btn-core h-32 flex flex-col items-center justify-center gap-2 group" style="border-color: var(--neon-cyan); color: var(--neon-cyan); text-shadow: 0 0 5px var(--neon-cyan);">
                        <i class="fa-solid fa-bullseye text-3xl mb-2 animate-pulse"></i>
                        <span class="orbitron tracking-tighter text-xs">VISUAL_SCAN</span>
                        <div class="absolute bottom-1 w-4/5 h-1 bg-current opacity-20"></div>
                    </button>
                </div>

                <input type="file" id="inp-file" accept="image/*" class="hidden" onchange="handleImage(event)">
                <input type="file" id="inp-camera" accept="image/*" capture="environment" class="hidden" onchange="handleImage(event)">

                <!-- PREVIEW PANEL -->
                <div id="preview-area" class="hidden animate-in slide-in-from-bottom-10 duration-500">
                    <div class="relative mb-8 rounded border-2 border-white/10 overflow-hidden bg-black shadow-[0_0_50px_rgba(0,0,0,1)]">
                        <div id="scanner" class="scan-line hidden"></div>
                        <img id="img-preview" class="w-full h-64 object-cover">
                        <div class="absolute top-2 left-2 orbitron text-[8px] bg-black/80 p-1 text-cyan-400 border border-cyan-500/50">PREVIEW_MODE::TRUE</div>
                    </div>

                    <button id="btn-analyze" onclick="startAnalysis()" class="w-full py-5 bg-white text-black orbitron font-[1000] text-lg tracking-[0.2em] shadow-[0_0_40px_rgba(255,255,255,0.3)] hover:bg-cyan-400 transition-all active:scale-95 mb-4">
                        <i class="fa-solid fa-bolt-lightning mr-2"></i> EXECUTE_SCAN
                    </button>
                </div>
            </div>
        </div>

        <!-- RESULTS SECTION -->
        <div id="result-area" class="hidden mt-12 pb-20">
            <div class="flex items-center gap-4 mb-6">
                <div class="h-[2px] flex-grow bg-gradient-to-r from-transparent to-magenta-500"></div>
                <h3 class="orbitron font-black text-sm tracking-[0.3em] text-magenta-500">ANALYSIS_REPORT</h3>
                <div class="h-[2px] flex-grow bg-gradient-to-l from-transparent to-magenta-500"></div>
            </div>

            <div id="coin-list" class="grid gap-3 mb-8"></div>

            <!-- FINAL SUM -->
            <div class="cyber-panel overflow-hidden">
                <div class="bg-gradient-to-br from-cyan-900/50 to-black p-8 text-center relative">
                    <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none" style="background-image: radial-gradient(var(--neon-cyan) 1px, transparent 1px); background-size: 10px 10px;"></div>
                    
                    <p class="orbitron font-black text-cyan-400 tracking-widest text-xs mb-4 uppercase">Grand Total Accumulated</p>
                    <div class="flex items-center justify-center gap-4">
                        <span id="total-val" class="orbitron total-display italic">0.00</span>
                        <div class="flex flex-col items-start">
                            <span class="orbitron text-2xl font-black text-white">THB</span>
                            <span class="orbitron text-[10px] text-cyan-500">CURR_VAL</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyCrzvLoRnoaQLtx2fril-GrIJubxqGyYCg"; // API Key provided by system
        let base64Img = "";

        // Background particles
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        class Particle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.v = Math.random() * 0.5 + 0.1;
                this.s = Math.random() * 2;
                this.o = Math.random();
            }
            draw() {
                ctx.fillStyle = `rgba(0, 243, 255, ${this.o})`;
                ctx.fillRect(this.x, this.y, this.s, this.s);
            }
            update() {
                this.y -= this.v;
                if (this.y < 0) this.reset();
            }
        }

        function initBg() {
            particles = [];
            for(let i=0; i<150; i++) particles.push(new Particle());
        }

        function animate() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);
        resize(); initBg(); animate();

        // App Logic
        function handleImage(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                document.getElementById('img-preview').src = ev.target.result;
                base64Img = ev.target.result.split(',')[1];
                document.getElementById('preview-area').classList.remove('hidden');
                document.getElementById('result-area').classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }

        async function startAnalysis() {
            const btn = document.getElementById('btn-analyze');
            const scanner = document.getElementById('scanner');
            
            btn.innerHTML = `<i class="fa-solid fa-atom fa-spin mr-2"></i> INTERPRETING_CORES...`;
            btn.classList.add('opacity-50');
            scanner.classList.remove('hidden');

            const prompt = `Identify Thai coins from this image. Count each denomination. Output ONLY a JSON object: {"items":[{"type":"เหรียญ 10 บาท","count":2,"val":20}], "total": 20}`;

            let retries = 0;
            const maxRetries = 5;
            
            async function callGemini() {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: "image/jpeg", data: base64Img } }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    
                    if (!response.ok) throw new Error('API_ERROR');
                    
                    const data = await response.json();
                    const result = JSON.parse(data.candidates[0].content.parts[0].text);
                    displayResults(result);
                } catch (err) {
                    if (retries < maxRetries) {
                        retries++;
                        const delay = Math.pow(2, retries) * 500;
                        setTimeout(callGemini, delay);
                    } else {
                        btn.innerHTML = `<i class="fa-solid fa-triangle-exclamation mr-2"></i> SCAN_FAILED`;
                        console.error(err);
                    }
                } finally {
                    if (retries === 0 || retries === maxRetries) {
                        btn.classList.remove('opacity-50');
                        scanner.classList.add('hidden');
                        if(retries === 0) btn.innerHTML = `<i class="fa-solid fa-bolt-lightning mr-2"></i> EXECUTE_SCAN`;
                    }
                }
            }
            
            callGemini();
        }

        function displayResults(data) {
            const list = document.getElementById('coin-list');
            list.innerHTML = "";
            
            data.items.forEach((item, idx) => {
                const row = document.createElement('div');
                row.className = "flex justify-between items-center p-5 bg-white/5 border-r-4 border-r-cyan-500 animate-in slide-in-from-right duration-300";
                row.style.animationDelay = `${idx * 100}ms`;
                row.innerHTML = `
                    <div class="flex flex-col">
                        <span class="orbitron text-[9px] text-cyan-400 font-black mb-1">DATA_ENTRY_${idx+1}</span>
                        <span class="kanit text-lg font-black text-white">${item.type} <span class="text-cyan-400">× ${item.count}</span></span>
                    </div>
                    <div class="text-right">
                        <span class="orbitron text-2xl font-black text-white glow-text" style="text-shadow: 0 0 10px var(--neon-cyan);">${item.val}</span>
                    </div>
                `;
                list.appendChild(row);
            });

            document.getElementById('total-val').innerText = data.total.toFixed(2);
            document.getElementById('result-area').classList.remove('hidden');
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 100);
        }
    </script>
</body>
</html>
</html>
</html>
